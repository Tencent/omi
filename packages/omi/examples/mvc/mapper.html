<script>
	/**
		* Auto map object's props to object's props.
		* @method mapper
		* @param {Object} From Object
		* @param {Object} To Object(可选)
		* @param {Object} Mapping Rules
		* @return {Object} To Object
		*/
	const mapper = function (from, to, rules) {
		let res
		if (arguments.length === 2) {
			rules = to
			res = {}
		} else {
			res = to
		}

		Object.keys(rules).forEach(key => {
			const rule = rules[key]
			const isPath = key.match(/\.|\[/)
			if (typeof rule === 'function') {
				if (isPath) {
					setPathValue(res, key, rule.call(from))
				} else {
					res[key] = rule.call(from)
				}

			} else {
				if (isPath) {
					setPathValue(res, key, rule)
				} else {
					res[key] = rule
				}

			}
		})
		return res

	}

	function setPathValue(obj, path, value) {
		const arr = path.replace(/]/g, '').replace(/\[/g, '.').split('.')

		let current = obj
		for (let i = 0, len = arr.length; i < len; i++) {
			const key = arr[i]
			let temp = current[key]
			if (i === len - 1) {
				current[arr[len - 1]] = value
			} else {
				if (temp === undefined) {
					if(isNaN(Number(arr[i+1]))){
						current[key] = {}
					}else{
						current[key] = []
					}

					temp = current[key]
				}
			}

			current = temp
		}

	}

	//mapper 独立发布
	var res = mapper({
		same: 10,
		bleh: 4,
		firstName: 'dnt',
		lastName: 'zhang',
		a: {
			c: 10
		}
	}, { aa: 1 }, {
			dumb: 12,
			func: function () {
				return 8
			},
			bar: function () {
				return this.bleh
			},
			fullName: function () {
				return this.firstName + this.lastName
			},
			'a[2].b[0]': function () {
				return this.a.c
			}
		})

	console.log(JSON.stringify(res,null,2))
// <!-- output
// 	{
//   "aa": 1,
//   "dumb": 12,
//   "func": 8,
//   "bar": 4,
//   "fullName": "dntzhang",
//   "a": [
//     null,
//     null,
//     {
//       "b": [
//         10
//       ]
//     }
//   ]
// } -->
</script>
